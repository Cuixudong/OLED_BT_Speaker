#include "oled.h"
#include <string.h>
#include "oledfont.h"
//////////////////////////////////////////////////////////////////////////////////
//本程序只供学习使用，未经作者许可，不得用于其它任何用途
//ALIENTEK战舰STM32开发板
//ALIENTEK OLED模块驱动代码
//正点原子@ALIENTEK
//技术论坛:www.openedv.com
//修改日期:2012/9/5
//版本：V1.0
//版权所有，盗版必究。
//Copyright(C) 广州市星翼电子科技有限公司 2009-2019
//All rights reserved
//////////////////////////////////////////////////////////////////////////////////

//OLED的显存
//存放格式如下.
//[0]0 1 2 3 ... 127
//[1]0 1 2 3 ... 127
//[2]0 1 2 3 ... 127
//[3]0 1 2 3 ... 127
//[4]0 1 2 3 ... 127
//[5]0 1 2 3 ... 127
//[6]0 1 2 3 ... 127
//[7]0 1 2 3 ... 127
uint8_t OLED_GRAM[128][8];

uint8_t OLED_GRAM_UI[128][8];

//更新显存到LCD
void OLED_Refresh_Gram(void)
{
    uint8_t i,n;
    for(i=0; i<8; i++)
    {
        OLED_WR_Byte (0xb0+i,OLED_CMD);    //设置页地址（0~7）
        OLED_WR_Byte (0x00,OLED_CMD);      //设置显示位置―列低地址
        OLED_WR_Byte (0x10,OLED_CMD);      //设置显示位置―列高地址
        for(n=0; n<128; n++)OLED_WR_Byte(OLED_GRAM[n][i],OLED_DATA);
    }
}

static void DATAOUT(uint8_t para)
{
    if(0)
    {
        if(para & 0x80)
        {
            HAL_GPIO_WritePin(OLED_D0_GPIO_Port,OLED_D0_Pin,GPIO_PIN_SET);
        }
        else
        {
            HAL_GPIO_WritePin(OLED_D0_GPIO_Port,OLED_D0_Pin,GPIO_PIN_RESET);
        }
        if(para & 0x40)
        {
            HAL_GPIO_WritePin(OLED_D1_GPIO_Port,OLED_D1_Pin,GPIO_PIN_SET);
        }
        else
        {
            HAL_GPIO_WritePin(OLED_D1_GPIO_Port,OLED_D1_Pin,GPIO_PIN_RESET);
        }
        if(para & 0x20)
        {
            HAL_GPIO_WritePin(OLED_D2_GPIO_Port,OLED_D2_Pin,GPIO_PIN_SET);
        }
        else
        {
            HAL_GPIO_WritePin(OLED_D2_GPIO_Port,OLED_D2_Pin,GPIO_PIN_RESET);
        }
        if(para & 0x10)
        {
            HAL_GPIO_WritePin(OLED_D3_GPIO_Port,OLED_D3_Pin,GPIO_PIN_SET);
        }
        else
        {
            HAL_GPIO_WritePin(OLED_D3_GPIO_Port,OLED_D3_Pin,GPIO_PIN_RESET);
        }
        if(para & 0x08)
        {
            HAL_GPIO_WritePin(OLED_D4_GPIO_Port,OLED_D4_Pin,GPIO_PIN_SET);
        }
        else
        {
            HAL_GPIO_WritePin(OLED_D4_GPIO_Port,OLED_D4_Pin,GPIO_PIN_RESET);
        }
        if(para & 0x04)
        {
            HAL_GPIO_WritePin(OLED_D5_GPIO_Port,OLED_D5_Pin,GPIO_PIN_SET);
        }
        else
        {
            HAL_GPIO_WritePin(OLED_D5_GPIO_Port,OLED_D5_Pin,GPIO_PIN_RESET);
        }
        if(para & 0x02)
        {
            HAL_GPIO_WritePin(OLED_D6_GPIO_Port,OLED_D6_Pin,GPIO_PIN_SET);
        }
        else
        {
            HAL_GPIO_WritePin(OLED_D6_GPIO_Port,OLED_D6_Pin,GPIO_PIN_RESET);
        }
        if(para & 0x01)
        {
            HAL_GPIO_WritePin(OLED_D7_GPIO_Port,OLED_D7_Pin,GPIO_PIN_SET);
        }
        else
        {
            HAL_GPIO_WritePin(OLED_D7_GPIO_Port,OLED_D7_Pin,GPIO_PIN_RESET);
        }
    }
    else
    {
        if(para & 0x01)
        {
            HAL_GPIO_WritePin(OLED_D0_GPIO_Port,OLED_D0_Pin,GPIO_PIN_SET);
        }
        else
        {
            HAL_GPIO_WritePin(OLED_D0_GPIO_Port,OLED_D0_Pin,GPIO_PIN_RESET);
        }
        if(para & 0x02)
        {
            HAL_GPIO_WritePin(OLED_D1_GPIO_Port,OLED_D1_Pin,GPIO_PIN_SET);
        }
        else
        {
            HAL_GPIO_WritePin(OLED_D1_GPIO_Port,OLED_D1_Pin,GPIO_PIN_RESET);
        }
        if(para & 0x04)
        {
            HAL_GPIO_WritePin(OLED_D2_GPIO_Port,OLED_D2_Pin,GPIO_PIN_SET);
        }
        else
        {
            HAL_GPIO_WritePin(OLED_D2_GPIO_Port,OLED_D2_Pin,GPIO_PIN_RESET);
        }
        if(para & 0x08)
        {
            HAL_GPIO_WritePin(OLED_D3_GPIO_Port,OLED_D3_Pin,GPIO_PIN_SET);
        }
        else
        {
            HAL_GPIO_WritePin(OLED_D3_GPIO_Port,OLED_D3_Pin,GPIO_PIN_RESET);
        }
        if(para & 0x10)
        {
            HAL_GPIO_WritePin(OLED_D4_GPIO_Port,OLED_D4_Pin,GPIO_PIN_SET);
        }
        else
        {
            HAL_GPIO_WritePin(OLED_D4_GPIO_Port,OLED_D4_Pin,GPIO_PIN_RESET);
        }
        if(para & 0x20)
        {
            HAL_GPIO_WritePin(OLED_D5_GPIO_Port,OLED_D5_Pin,GPIO_PIN_SET);
        }
        else
        {
            HAL_GPIO_WritePin(OLED_D5_GPIO_Port,OLED_D5_Pin,GPIO_PIN_RESET);
        }
        if(para & 0x40)
        {
            HAL_GPIO_WritePin(OLED_D6_GPIO_Port,OLED_D6_Pin,GPIO_PIN_SET);
        }
        else
        {
            HAL_GPIO_WritePin(OLED_D6_GPIO_Port,OLED_D6_Pin,GPIO_PIN_RESET);
        }
        if(para & 0x80)
        {
            HAL_GPIO_WritePin(OLED_D7_GPIO_Port,OLED_D7_Pin,GPIO_PIN_SET);
        }
        else
        {
            HAL_GPIO_WritePin(OLED_D7_GPIO_Port,OLED_D7_Pin,GPIO_PIN_RESET);
        }
    }
}

#if OLED_MODE==1
//向SSD1306写入一个字节。
//dat:要写入的数据/命令
//cmd:数据/命令标志 0,表示命令;1,表示数据;
void OLED_WR_Byte(uint8_t dat,uint8_t cmd)
{
    DATAOUT(dat);
    if(cmd)
        HAL_GPIO_WritePin(OLED_DC_GPIO_Port,OLED_DC_Pin,GPIO_PIN_SET);
    else
        HAL_GPIO_WritePin(OLED_DC_GPIO_Port,OLED_DC_Pin,GPIO_PIN_RESET);
    HAL_GPIO_WritePin(OLED_CS_GPIO_Port,OLED_CS_Pin,GPIO_PIN_RESET);
    HAL_GPIO_WritePin(OLED_RW_GPIO_Port,OLED_RW_Pin,GPIO_PIN_RESET);
    HAL_GPIO_WritePin(OLED_RW_GPIO_Port,OLED_RW_Pin,GPIO_PIN_SET);
    HAL_GPIO_WritePin(OLED_CS_GPIO_Port,OLED_CS_Pin,GPIO_PIN_SET);
    HAL_GPIO_WritePin(OLED_DC_GPIO_Port,OLED_DC_Pin,GPIO_PIN_SET);
}
#else
//向SSD1306写入一个字节。
//dat:要写入的数据/命令
//cmd:数据/命令标志 0,表示命令;1,表示数据;
void OLED_WR_Byte(uint8_t dat,uint8_t cmd)
{
    uint8_t i;
    if(cmd)
        OLED_RS_Set();
    else
        OLED_RS_Clr();
    HAL_GPIO_WritePin(OLED_CS_GPIO_Port,OLED_CS_Pin,GPIO_PIN_RESET);
    for(i=0; i<8; i++)
    {
        OLED_SCLK_Clr();
        if(dat&0x80)
            OLED_SDIN_Set();
        else
            OLED_SDIN_Clr();
        OLED_SCLK_Set();
        dat<<=1;
    }
    HAL_GPIO_WritePin(OLED_CS_GPIO_Port,OLED_CS_Pin,GPIO_PIN_SET);
    OLED_RS_Set();
}
#endif

//开启OLED显示
void OLED_Display_On(void)
{
    OLED_WR_Byte(0X8D,OLED_CMD);  //SET DCDC命令
    OLED_WR_Byte(0X14,OLED_CMD);  //DCDC ON
    OLED_WR_Byte(0XAF,OLED_CMD);  //DISPLAY ON
}
//关闭OLED显示
void OLED_Display_Off(void)
{
    OLED_WR_Byte(0X8D,OLED_CMD);  //SET DCDC命令
    OLED_WR_Byte(0X10,OLED_CMD);  //DCDC OFF
    OLED_WR_Byte(0XAE,OLED_CMD);  //DISPLAY OFF
}
//清屏函数,清完屏,整个屏幕是黑色的!和没点亮一样!!!
void OLED_Clear(void)
{
    uint8_t i,n;
    for(i=0; i<8; i++)for(n=0; n<128; n++)OLED_GRAM[n][i]=0X00;
    OLED_Refresh_Gram();//更新显示
}
//画点
//x:0~127
//y:0~63
//t:1 填充 0,清空
void OLED_DrawPoint(uint8_t x,uint8_t y,uint8_t t)
{
    uint8_t pos,bx,temp=0;
    if(x>127||y>63)return;//超出范围了.
    pos=7-y/8;
    bx=y%8;
    temp=1<<(7-bx);
    if(t)OLED_GRAM[x][pos]|=temp;
    else OLED_GRAM[x][pos]&=~temp;
}

//读点
//x:0~127
//y:0~63
uint8_t OLED_ReadPoint(uint8_t x,uint8_t y)
{
    uint8_t pos,bx,temp=0x00;
    //x = 127-x;
    y = 63-y;
    pos=y/8;
    bx=y%8;
    temp=1<<bx;
    if(temp&OLED_GRAM[x][pos]) return 1;
    return 0;
}

//x1,y1,x2,y2 填充区域的对角坐标
//确保x1<=x2;y1<=y2 0<=x1<=127 0<=y1<=63
//dot:0,清空;1,填充
void OLED_Fill(uint8_t x1,uint8_t y1,uint8_t x2,uint8_t y2,uint8_t dot)
{
    uint8_t x,y;
    for(x=x1; x<=x2; x++)
    {
        for(y=y1; y<=y2; y++)OLED_DrawPoint(x,y,dot);
    }
}
//在指定位置显示一个字符,包括部分字符
//x:0~127
//y:0~63
//mode:0,反白显示;1,正常显示
//size:选择字体 16/12
void OLED_ShowChar(uint8_t x,uint8_t y,uint8_t chr,uint8_t size,uint8_t mode)
{
    uint8_t temp,t,t1;
    uint8_t y0=y;
    chr=chr-' ';//得到偏移后的值
    for(t=0; t<size; t++)
    {
        if(size==12)temp=oled_asc2_1206[chr][t];  //调用1206字体
        else temp=oled_asc2_1608[chr][t];		 //调用1608字体
        for(t1=0; t1<8; t1++)
        {
            if(temp&0x80)OLED_DrawPoint(x,y,mode);
            else OLED_DrawPoint(x,y,!mode);
            temp<<=1;
            y++;
            if((y-y0)==size)
            {
                y=y0;
                x++;
                break;
            }
        }
    }
}
//m^n函数
uint32_t oled_pow(uint8_t m,uint8_t n)
{
    uint32_t result=1;
    while(n--)result*=m;
    return result;
}
//显示2个数字
//x,y :起点坐标
//len :数字的位数
//size:字体大小
//mode:模式	0,填充模式;1,叠加模式
//num:数值(0~4294967295);
void OLED_ShowNum(uint8_t x,uint8_t y,uint32_t num,uint8_t len,uint8_t size)
{
    uint8_t t,temp;
    uint8_t enshow=0;
    for(t=0; t<len; t++)
    {
        temp=(num/oled_pow(10,len-t-1))%10;
        if(enshow==0&&t<(len-1))
        {
            if(temp==0)
            {
                OLED_ShowChar(x+(size/2)*t,y,' ',size,1);
                continue;
            } else enshow=1;

        }
        OLED_ShowChar(x+(size/2)*t,y,temp+'0',size,1);
    }
}
//显示字符串
//x,y:起点坐标
//*p:字符串起始地址
//用16字体
void OLED_ShowString(uint8_t x,uint8_t y,const uint8_t *p)
{
#define MAX_CHAR_POSX 122
#define MAX_CHAR_POSY 58
    while(*p!='\0')
    {
        if(x>MAX_CHAR_POSX) {
            x=0;
            y+=16;
        }
        if(y>MAX_CHAR_POSY) {
            y=x=0;
            OLED_Clear();
        }
        OLED_ShowChar(x,y,*p,16,1);
        x+=8;
        p++;
    }
}

#define  LCD_WIDTH		128
#define  LCD_HIGH		64

const char* font1212_table =
{
    "蓝牙音箱版本号已连接断开等待中开关机请充电池压量低波形频谱显示静播放正常模式年月日星期上下午"
};

const char* font1616_table =
{
    "蓝牙音箱版本号已连接断开等待中开关机请充电池压量低波形频谱显示静播放正常模式年月日星期上下午"
};

//汉字点阵 12*12(宋体) 阴码逐列顺向
const unsigned char font_1212[46][24]= {

    {0x40,0x10,0x4E,0xF0,0xE0,0x90,0x5E,0x90,0x40,0xF0,0x44,0x90,0x58,0xF0,0x48,0x90,0xEC,0x90,0x4A,0xF0,0x48,0x10,0x00,0x00},/*"蓝",0*/
    {0x00,0x20,0x4C,0x20,0x54,0x40,0x44,0x40,0x44,0x80,0x45,0x10,0x46,0x10,0x7F,0xF0,0x44,0x00,0x44,0x00,0x04,0x00,0x00,0x00},/*"牙",1*/
    {0x08,0x00,0x4B,0xF0,0x6A,0xA0,0x5A,0xA0,0x4A,0xA0,0xCA,0xA0,0x4A,0xA0,0x5A,0xA0,0x6A,0xA0,0x4B,0xF0,0x08,0x00,0x00,0x00},/*"音",2*/
    {0x24,0x80,0xC5,0x00,0x5F,0xF0,0x65,0x00,0x44,0x80,0x2F,0xF0,0xCA,0xA0,0x4A,0xA0,0x6A,0xA0,0x4A,0xA0,0x4F,0xF0,0x00,0x00},/*"箱",3*/
    {0x00,0x10,0x7F,0xE0,0x09,0x00,0xF9,0xF0,0x08,0x20,0x7F,0xC0,0x48,0x10,0x4F,0xA0,0x48,0x40,0x89,0xA0,0x8E,0x10,0x00,0x00},/*"版",4*/
    {0x20,0x40,0x20,0x80,0x21,0x40,0x26,0x40,0x28,0x40,0xFF,0xF0,0x28,0x40,0x26,0x40,0x21,0x40,0x20,0x80,0x20,0x40,0x00,0x00},/*"本",5*/
    {0x04,0x00,0x04,0x00,0xF5,0x80,0x96,0x80,0x94,0x80,0x94,0x80,0x94,0x80,0x94,0x90,0xF4,0x90,0x04,0xE0,0x04,0x00,0x00,0x00},/*"号",6*/
    {0x00,0x00,0x4F,0xE0,0x42,0x10,0x42,0x10,0x42,0x10,0x42,0x10,0x42,0x10,0x42,0x10,0x42,0x10,0x7E,0x10,0x00,0x70,0x00,0x00},/*"已",7*/
    {0x84,0x10,0x47,0xE0,0x00,0x10,0x20,0x90,0x2C,0x90,0x34,0x90,0xE4,0x90,0x2F,0xF0,0x24,0x90,0x24,0x90,0x20,0x90,0x00,0x00},/*"连",8*/
    {0x11,0x00,0x11,0x10,0xFF,0xF0,0x12,0x00,0x25,0x10,0x35,0x50,0xAD,0xD0,0x67,0x20,0x2D,0x20,0x35,0xD0,0x25,0x10,0x00,0x00},/*"接",9*/
    {0x3F,0xE0,0x49,0x20,0x2A,0x20,0xFF,0xE0,0x2A,0x20,0x49,0x20,0x00,0x10,0x7F,0xE0,0x48,0x00,0x4F,0xF0,0x88,0x00,0x00,0x00},/*"断",10*/
    {0x02,0x00,0x42,0x10,0x42,0x60,0x7F,0x80,0x42,0x00,0x42,0x00,0x42,0x00,0x7F,0xF0,0x42,0x00,0x42,0x00,0x02,0x00,0x00,0x00},/*"开",11*/
    {0x22,0x80,0xCA,0x80,0x4A,0xC0,0x6A,0xA0,0x4A,0x80,0x3E,0x90,0xCA,0x90,0x4B,0xF0,0x6A,0x80,0x4A,0x80,0x42,0x80,0x00,0x00},/*"等",12*/
    {0x12,0x00,0x24,0x00,0x4F,0xF0,0x90,0x00,0x0A,0x00,0x2A,0x80,0x2A,0x50,0xFA,0x10,0x2F,0xF0,0x2A,0x00,0x0A,0x00,0x00,0x00},/*"待",13*/
    {0x00,0x00,0x1F,0x80,0x11,0x00,0x11,0x00,0x11,0x00,0xFF,0xF0,0x11,0x00,0x11,0x00,0x11,0x00,0x1F,0x80,0x00,0x00,0x00,0x00},/*"中",14*/
    {0x02,0x00,0x42,0x10,0x42,0x60,0x7F,0x80,0x42,0x00,0x42,0x00,0x42,0x00,0x7F,0xF0,0x42,0x00,0x42,0x00,0x02,0x00,0x00,0x00},/*"开",15*/
    {0x02,0x10,0x12,0x10,0x92,0x20,0x52,0x40,0x12,0x80,0x1F,0x00,0x12,0x80,0x52,0x40,0x92,0x20,0x12,0x10,0x02,0x10,0x00,0x00},/*"关",16*/
    {0x11,0x00,0x16,0x00,0xFF,0xF0,0x14,0x10,0x02,0x20,0x7F,0xC0,0x40,0x00,0x40,0x00,0x7F,0xE0,0x00,0x10,0x00,0x70,0x00,0x00},/*"机",17*/
    {0x88,0x00,0x4F,0xF0,0x00,0x20,0x44,0x00,0x57,0xF0,0x55,0x40,0xFD,0x40,0x55,0x40,0x55,0x50,0x57,0xF0,0x44,0x00,0x00,0x00},/*"请",18*/
    {0x20,0x10,0x22,0x10,0x26,0x20,0x2B,0xC0,0xB2,0x00,0x62,0x00,0x22,0x00,0x2B,0xE0,0x26,0x10,0x23,0x10,0x20,0x70,0x00,0x00},/*"充",19*/
    {0x3F,0xC0,0x24,0x80,0x24,0x80,0x24,0x80,0xFF,0xE0,0x24,0x90,0x24,0x90,0x24,0x90,0x3F,0x90,0x00,0x10,0x00,0x70,0x00,0x00},/*"电",20*/
    {0x44,0x20,0x22,0x40,0x02,0x00,0x3F,0xE0,0x04,0x10,0x08,0x10,0xFF,0xD0,0x10,0x10,0x20,0x90,0x3F,0x90,0x00,0x30,0x00,0x00},/*"池",21*/
    {0x00,0x10,0x7F,0xE0,0x40,0x10,0x42,0x10,0x42,0x10,0x42,0x10,0x5F,0xF0,0x42,0x10,0x42,0x90,0x42,0x50,0x40,0x10,0x00,0x00},/*"压",22*/
    {0x10,0x10,0xFF,0x50,0x95,0x50,0x95,0x50,0x95,0x50,0xDF,0xF0,0xB5,0x50,0x95,0x50,0x95,0x50,0xFF,0x50,0x10,0x10,0x00,0x00},/*"量",23*/
    {0x04,0x00,0x08,0x00,0x3F,0xF0,0xC0,0x00,0x7F,0xE0,0x44,0x40,0x44,0xA0,0x7F,0x10,0x84,0xC0,0x84,0x20,0x04,0xF0,0x00,0x00},/*"低",24*/
    {0x44,0x20,0x22,0x40,0x00,0x10,0x3F,0xE0,0x24,0x10,0x27,0x10,0x24,0xA0,0xFC,0x40,0x24,0xA0,0x27,0x10,0x30,0x10,0x00,0x00},/*"波",25*/
    {0x44,0x10,0x7F,0xE0,0x44,0x00,0x44,0x00,0x7F,0xF0,0x44,0x00,0x00,0x10,0x11,0x10,0x22,0x20,0xC4,0x40,0x18,0x80,0x00,0x00},/*"形",26*/
    {0x08,0x90,0x7B,0x10,0x08,0x20,0xFF,0x40,0x48,0x80,0x49,0x00,0x9F,0x90,0xB0,0x20,0xD7,0xC0,0x90,0x20,0x9F,0x90,0x00,0x00},/*"频",27*/
    {0x08,0x00,0x88,0x00,0x4F,0xE0,0x00,0x40,0x54,0x00,0xC5,0xF0,0x7D,0x50,0x45,0x50,0x7D,0x50,0xC5,0xF0,0x54,0x00,0x00,0x00},/*"谱",28*/
    {0x01,0x10,0x7C,0x90,0x54,0x50,0x57,0xF0,0x54,0x10,0x54,0x10,0x54,0x10,0x57,0xF0,0x54,0x50,0x7C,0x90,0x01,0x10,0x00,0x00},/*"显",29*/
    {0x08,0x20,0x08,0x40,0x49,0x80,0x48,0x00,0x48,0x10,0x4F,0xF0,0x48,0x00,0x48,0x00,0x49,0x00,0x08,0x80,0x08,0x60,0x00,0x00},/*"示",30*/
    {0x44,0x00,0x57,0xF0,0xFD,0x40,0x57,0xF0,0x54,0x00,0x2A,0x80,0xCA,0x90,0x5F,0xF0,0x6A,0x80,0x0F,0xC0,0x02,0x00,0x00,0x00},/*"静",31*/
    {0x11,0x10,0xFF,0xF0,0x12,0x00,0x6B,0xF0,0x5D,0x50,0x49,0x50,0x7D,0xF0,0x89,0x50,0x9D,0x50,0xAB,0xF0,0x09,0x00,0x00,0x00},/*"播",32*/
    {0x10,0x10,0x9F,0xE0,0x52,0x00,0x12,0x10,0x13,0xF0,0x04,0x00,0x08,0x10,0xF7,0xA0,0x10,0x40,0x1F,0xA0,0x10,0x10,0x00,0x00},/*"放",33*/
    {0x00,0x10,0x40,0x10,0x47,0xF0,0x40,0x10,0x40,0x10,0x7F,0xF0,0x42,0x10,0x42,0x10,0x42,0x10,0x42,0x10,0x00,0x10,0x00,0x00},/*"正",34*/
    {0x30,0x00,0x20,0xE0,0xAE,0x80,0x6A,0x80,0x2A,0x80,0xEB,0xF0,0x2A,0x80,0x6A,0x80,0xAE,0xA0,0x20,0xE0,0x30,0x00,0x00,0x00},/*"常",35*/
    {0x11,0x00,0x16,0x00,0xFF,0xF0,0x12,0x00,0x40,0x50,0x5F,0x50,0xF5,0x60,0x55,0xC0,0xF5,0x60,0x5F,0x50,0x40,0x50,0x00,0x00},/*"模",36*/
    {0x10,0x10,0x12,0x10,0x12,0x10,0x13,0xE0,0x12,0x20,0x12,0x20,0x10,0x20,0xFF,0x00,0x10,0xC0,0x90,0x20,0x50,0x70,0x00,0x00},/*"式",37*/
    {0x08,0x80,0x10,0x80,0xE7,0x80,0x24,0x80,0x24,0x80,0x24,0x80,0x3F,0xF0,0x24,0x80,0x24,0x80,0x24,0x80,0x20,0x80,0x00,0x00},/*"年",38*/
    {0x00,0x10,0x00,0x60,0x7F,0x80,0x49,0x00,0x49,0x00,0x49,0x00,0x49,0x00,0x49,0x10,0x49,0x10,0x7F,0xF0,0x00,0x00,0x00,0x00},/*"月",39*/
    {0x00,0x00,0x7F,0xF0,0x44,0x20,0x44,0x20,0x44,0x20,0x44,0x20,0x44,0x20,0x44,0x20,0x44,0x20,0x7F,0xF0,0x00,0x00,0x00,0x00},/*"日",40*/
    {0x00,0x90,0xFB,0x10,0xA9,0x50,0xA9,0x50,0xA9,0x50,0xAF,0xF0,0xA9,0x50,0xA9,0x50,0xA9,0x50,0xF9,0x10,0x00,0x10,0x00,0x00},/*"星",41*/
    {0x20,0x90,0xFF,0xA0,0x2A,0x80,0x2A,0x80,0xFF,0xA0,0x20,0x90,0x00,0x10,0x7F,0xE0,0x49,0x00,0x49,0x10,0x7F,0xF0,0x00,0x00},/*"期",42*/
    {0x00,0x10,0x00,0x10,0x00,0x10,0x00,0x10,0xFF,0xF0,0x08,0x10,0x08,0x10,0x08,0x10,0x08,0x10,0x08,0x10,0x00,0x10,0x00,0x00},/*"上",43*/
    {0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x7F,0xF0,0x40,0x00,0x48,0x00,0x44,0x00,0x42,0x00,0x41,0x80,0x40,0x00,0x00,0x00},/*"下",44*/
    {0x09,0x00,0x11,0x00,0xE1,0x00,0x21,0x00,0x21,0x00,0x3F,0xF0,0x21,0x00,0x21,0x00,0x21,0x00,0x21,0x00,0x01,0x00,0x00,0x00},/*"午",45*/

};

const unsigned char font_1616[46][32]= {
    {0x20,0x02,0x20,0x02,0x27,0xBE,0x20,0x22,0xF0,0x22,0x2F,0xBE,0x20,0x22,0x20,0xA2,0x2F,0x22,0x22,0x3E,0xF3,0x22,0x22,0xA2,0x22,0x3E,0x22,0x02,0x20,0x02,0x00,0x00},/*"蓝",0*/
    {0x00,0x00,0x00,0x04,0x43,0x04,0x4D,0x08,0x41,0x10,0x41,0x20,0x41,0x40,0x41,0x82,0x41,0x01,0x7F,0xFE,0x41,0x00,0x41,0x00,0x41,0x00,0x41,0x00,0x01,0x00,0x00,0x00},/*"牙",1*/
    {0x02,0x00,0x02,0x00,0x22,0x00,0x22,0xFF,0x2A,0x92,0x26,0x92,0xA2,0x92,0x62,0x92,0x22,0x92,0x26,0x92,0x2A,0x92,0x22,0xFF,0x22,0x00,0x02,0x00,0x02,0x00,0x00,0x00},/*"音",2*/
    {0x04,0x02,0x09,0x04,0x31,0x18,0xE1,0x60,0x37,0xFF,0x29,0x20,0x21,0x18,0x28,0x00,0x13,0xFF,0xE2,0x49,0x22,0x49,0x32,0x49,0x2A,0x49,0x23,0xFF,0x20,0x00,0x00,0x00},/*"箱",3*/
    {0x00,0x01,0x7F,0xFE,0x04,0x80,0x04,0x80,0xFC,0xFF,0x04,0x01,0x00,0x06,0x3F,0xF8,0x24,0x01,0x27,0x82,0x24,0x64,0x44,0x18,0xC4,0x64,0x47,0x82,0x00,0x01,0x00,0x00},/*"版",4*/
    {0x00,0x08,0x08,0x10,0x08,0x20,0x08,0x40,0x08,0x90,0x0B,0x10,0x0C,0x10,0xFF,0xFF,0x0C,0x10,0x0B,0x10,0x08,0x90,0x08,0x40,0x08,0x20,0x08,0x10,0x00,0x08,0x00,0x00},/*"本",5*/
    {0x01,0x00,0x01,0x00,0x01,0x00,0x7D,0x60,0x45,0xA0,0x45,0x20,0x45,0x20,0x45,0x20,0x45,0x22,0x45,0x21,0x45,0x22,0x7D,0x3C,0x01,0x00,0x01,0x00,0x01,0x00,0x00,0x00},/*"号",6*/
    {0x00,0x00,0x00,0x00,0x47,0xFC,0x41,0x02,0x41,0x02,0x41,0x02,0x41,0x02,0x41,0x02,0x41,0x02,0x41,0x02,0x41,0x02,0x7F,0x02,0x00,0x02,0x00,0x1E,0x00,0x00,0x00,0x00},/*"已",7*/
    {0x02,0x00,0x02,0x02,0x42,0x04,0x33,0xF8,0x00,0x04,0x20,0x22,0x22,0x22,0x26,0x22,0x3A,0x22,0xE2,0x22,0x2F,0xFE,0x22,0x22,0x22,0x22,0x22,0x22,0x20,0x22,0x00,0x00},/*"连",8*/
    {0x08,0x20,0x08,0x22,0x08,0x41,0xFF,0xFE,0x08,0x80,0x0A,0x41,0x22,0x41,0x2A,0x52,0xA6,0x6A,0x63,0xC4,0x22,0x44,0x26,0x4A,0x2A,0x72,0x22,0x41,0x02,0x40,0x00,0x00},/*"接",9*/
    {0x00,0x00,0x3F,0xFC,0x04,0x44,0x24,0x84,0x15,0x04,0xFF,0xF4,0x15,0x04,0x24,0xC5,0x00,0x06,0x3F,0xF8,0x22,0x00,0x22,0x00,0x23,0xFF,0x42,0x00,0x02,0x00,0x00,0x00},/*"断",10*/
    {0x01,0x00,0x41,0x01,0x41,0x02,0x41,0x0C,0x7F,0xF0,0x41,0x00,0x41,0x00,0x41,0x00,0x41,0x00,0x41,0x00,0x7F,0xFF,0x41,0x00,0x41,0x00,0x41,0x00,0x01,0x00,0x00,0x00},/*"开",11*/
    {0x10,0x80,0x20,0x90,0xC4,0x90,0x44,0x90,0x64,0x98,0x54,0x96,0x44,0x90,0x5F,0x90,0x24,0x92,0xC4,0x91,0x44,0xBE,0x64,0x90,0x54,0x90,0x40,0x90,0x40,0x80,0x00,0x00},/*"等",12*/
    {0x00,0x40,0x08,0x80,0x11,0x00,0x23,0xFF,0xCC,0x00,0x02,0x40,0x12,0x50,0x12,0x4C,0x12,0x40,0xFE,0x42,0x12,0x41,0x13,0xFE,0x12,0x40,0x12,0x40,0x02,0x40,0x00,0x00},/*"待",13*/
    {0x00,0x00,0x00,0x00,0x0F,0xF0,0x08,0x20,0x08,0x20,0x08,0x20,0x08,0x20,0xFF,0xFF,0x08,0x20,0x08,0x20,0x08,0x20,0x08,0x20,0x0F,0xF0,0x00,0x00,0x00,0x00,0x00,0x00},/*"中",14*/
    {0x01,0x00,0x41,0x01,0x41,0x02,0x41,0x0C,0x7F,0xF0,0x41,0x00,0x41,0x00,0x41,0x00,0x41,0x00,0x41,0x00,0x7F,0xFF,0x41,0x00,0x41,0x00,0x41,0x00,0x01,0x00,0x00,0x00},/*"开",15*/
    {0x00,0x81,0x00,0x81,0x08,0x82,0x88,0x82,0x68,0x84,0x08,0x88,0x08,0xB0,0x0F,0xC0,0x08,0xB0,0x08,0x88,0x28,0x84,0xC8,0x82,0x08,0x82,0x00,0x81,0x00,0x81,0x00,0x00},/*"关",16*/
    {0x08,0x20,0x08,0xC0,0x0B,0x00,0xFF,0xFF,0x09,0x00,0x08,0xC1,0x00,0x06,0x7F,0xF8,0x40,0x00,0x40,0x00,0x40,0x00,0x7F,0xFC,0x00,0x02,0x00,0x02,0x00,0x1E,0x00,0x00},/*"机",17*/
    {0x02,0x00,0x42,0x00,0x33,0xFE,0x00,0x04,0x00,0x08,0x22,0x00,0x2A,0xFF,0x2A,0xA8,0x2A,0xA8,0xFE,0xA8,0x2A,0xAA,0x2A,0xA9,0x2A,0xFE,0x22,0x00,0x02,0x00,0x00,0x00},/*"请",18*/
    {0x20,0x00,0x20,0x01,0x21,0x01,0x23,0x02,0x25,0x0C,0x39,0xF0,0xA1,0x00,0x61,0x00,0x21,0x00,0x21,0xFE,0x25,0x01,0x23,0x01,0x21,0x81,0x20,0x0F,0x20,0x00,0x00,0x00},/*"充",19*/
    {0x00,0x00,0x00,0x00,0x1F,0xF8,0x11,0x10,0x11,0x10,0x11,0x10,0x11,0x10,0xFF,0xFE,0x11,0x11,0x11,0x11,0x11,0x11,0x11,0x11,0x1F,0xF9,0x00,0x01,0x00,0x0F,0x00,0x00},/*"电",20*/
    {0x08,0x20,0x06,0x20,0x40,0x7E,0x33,0x80,0x01,0x00,0x01,0x00,0x3F,0xFC,0x02,0x02,0x04,0x02,0xFF,0xF2,0x08,0x02,0x10,0x22,0x1F,0xE2,0x00,0x02,0x00,0x1E,0x00,0x00},/*"池",21*/
    {0x00,0x01,0x00,0x06,0x7F,0xF8,0x40,0x02,0x41,0x02,0x41,0x02,0x41,0x02,0x41,0x02,0x5F,0xFE,0x41,0x02,0x41,0x02,0x41,0x22,0x41,0x1A,0x41,0x02,0x40,0x02,0x00,0x00},/*"压",22*/
    {0x04,0x00,0x04,0x01,0x04,0x01,0x7D,0xF5,0x55,0x55,0x55,0x55,0x55,0x55,0x55,0xFF,0x55,0x55,0x55,0x55,0x55,0x55,0x7D,0xF5,0x04,0x01,0x04,0x01,0x04,0x00,0x00,0x00},/*"量",23*/
    {0x00,0x80,0x01,0x00,0x06,0x00,0x1F,0xFF,0xE0,0x00,0x00,0x00,0x3F,0xFF,0x21,0x02,0x21,0x04,0x21,0x00,0x7F,0x82,0x41,0x71,0xC1,0x0C,0x41,0x02,0x01,0x1F,0x00,0x00},/*"低",24*/
    {0x08,0x20,0x06,0x20,0x40,0x3E,0x30,0xC0,0x03,0x01,0x00,0x06,0x1F,0xF8,0x11,0x01,0x11,0xC2,0x11,0x34,0xFF,0x08,0x11,0x14,0x11,0x62,0x15,0x81,0x18,0x01,0x00,0x00},/*"波",25*/
    {0x01,0x01,0x41,0x02,0x41,0x0C,0x7F,0xF0,0x41,0x00,0x41,0x00,0x7F,0xFF,0x41,0x00,0x41,0x00,0x01,0x01,0x04,0x21,0x08,0x42,0x10,0x84,0x61,0x08,0x06,0x30,0x00,0x00},/*"形",26*/
    {0x02,0x09,0x3E,0x71,0x02,0x02,0xFE,0xF2,0x12,0x04,0x12,0x78,0x02,0x01,0x4F,0xF2,0x48,0x04,0x58,0x18,0x6B,0xE0,0x48,0x08,0x48,0x04,0x4F,0xF2,0x40,0x01,0x00,0x00},/*"频",27*/
    {0x02,0x00,0x42,0x00,0x33,0xFE,0x00,0x04,0x02,0x08,0x2A,0x00,0xA6,0xFF,0x62,0x92,0x3E,0x92,0x22,0x92,0x3E,0x92,0x62,0x92,0xA6,0xFF,0x2A,0x00,0x02,0x00,0x00,0x00},/*"谱",28*/
    {0x00,0x02,0x00,0x42,0x00,0x22,0x7F,0x1A,0x49,0x02,0x49,0xFE,0x49,0x02,0x49,0x02,0x49,0x02,0x49,0xFE,0x49,0x02,0x7F,0x0A,0x00,0x12,0x00,0x62,0x00,0x02,0x00,0x00},/*"显",29*/
    {0x02,0x04,0x02,0x08,0x42,0x10,0x42,0x60,0x42,0x00,0x42,0x02,0x42,0x01,0x43,0xFE,0x42,0x00,0x42,0x00,0x42,0x00,0x42,0x40,0x42,0x20,0x02,0x10,0x02,0x0C,0x00,0x00},/*"示",30*/
    {0x22,0x00,0x2A,0xFF,0x2A,0xA8,0xFE,0xAA,0x2A,0xA9,0x2A,0xFE,0x22,0x00,0x04,0x90,0x14,0x92,0xE4,0x91,0x27,0xFE,0x2C,0x90,0x34,0x90,0x07,0xF8,0x00,0x80,0x00,0x00},/*"静",31*/
    {0x08,0x42,0x08,0x41,0xFF,0xFE,0x08,0x80,0x09,0x00,0x41,0x00,0x6A,0xFF,0x5C,0x92,0x48,0x92,0xFE,0xFE,0x88,0x92,0x9C,0x92,0xAA,0xFF,0x09,0x00,0x01,0x00,0x00,0x00},/*"播",32*/
    {0x10,0x02,0x10,0x0C,0x9F,0xF0,0x52,0x04,0x12,0x02,0x13,0xFC,0x12,0x01,0x04,0x02,0x1B,0x84,0xE8,0x68,0x08,0x10,0x08,0x68,0x0F,0x84,0x08,0x02,0x08,0x01,0x00,0x00},/*"放",33*/
    {0x00,0x02,0x40,0x02,0x40,0x02,0x43,0xFE,0x40,0x02,0x40,0x02,0x40,0x02,0x7F,0xFE,0x41,0x02,0x41,0x02,0x41,0x02,0x41,0x02,0x41,0x02,0x40,0x02,0x00,0x02,0x00,0x00},/*"正",34*/
    {0x04,0x00,0x18,0x00,0x10,0x7C,0x57,0x40,0x35,0x40,0x15,0x40,0x15,0x40,0xF5,0xFF,0x15,0x40,0x15,0x40,0x35,0x48,0x57,0x44,0x10,0x78,0x14,0x00,0x18,0x00,0x00,0x00},/*"常",35*/
    {0x08,0x20,0x08,0xC0,0x0B,0x00,0xFF,0xFF,0x09,0x00,0x28,0x91,0x27,0xD2,0xF5,0x54,0x25,0x58,0x25,0x70,0x25,0x58,0xF5,0x54,0x27,0xD2,0x20,0x11,0x00,0x01,0x00,0x00},/*"模",36*/
    {0x08,0x00,0x08,0x04,0x09,0x06,0x09,0x04,0x09,0xFC,0x09,0x08,0x09,0x08,0x08,0x08,0x08,0x00,0xFF,0xC0,0x08,0x30,0x08,0x08,0x88,0x04,0x68,0x02,0x08,0x1F,0x00,0x00},/*"式",37*/
    {0x00,0x20,0x04,0x20,0x18,0x20,0xE3,0xE0,0x22,0x20,0x22,0x20,0x22,0x20,0x22,0x20,0x3F,0xFF,0x22,0x20,0x22,0x20,0x22,0x20,0x22,0x20,0x20,0x20,0x00,0x20,0x00,0x00},/*"年",38*/
    {0x00,0x01,0x00,0x02,0x00,0x0C,0x7F,0xF0,0x44,0x40,0x44,0x40,0x44,0x40,0x44,0x40,0x44,0x40,0x44,0x40,0x44,0x42,0x44,0x41,0x7F,0xFE,0x00,0x00,0x00,0x00,0x00,0x00},/*"月",39*/
    {0x00,0x00,0x00,0x00,0x00,0x00,0x7F,0xFF,0x41,0x02,0x41,0x02,0x41,0x02,0x41,0x02,0x41,0x02,0x41,0x02,0x41,0x02,0x7F,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},/*"日",40*/
    {0x00,0x00,0x00,0x22,0x00,0x42,0x7D,0x92,0x54,0x92,0x54,0x92,0x54,0x92,0x57,0xFE,0x54,0x92,0x54,0x92,0x54,0x92,0x7C,0x92,0x00,0x82,0x00,0x02,0x00,0x00,0x00,0x00},/*"星",41*/
    {0x00,0x11,0x20,0x12,0xFF,0xF4,0x24,0x90,0x24,0x90,0x24,0x98,0xFF,0xF5,0x20,0x12,0x00,0x0C,0x7F,0xF0,0x44,0x40,0x44,0x42,0x44,0x41,0x7F,0xFE,0x00,0x00,0x00,0x00},/*"期",42*/
    {0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0xFF,0xFE,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x00,0x02,0x00,0x02,0x00,0x00},/*"上",43*/
    {0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x7F,0xFF,0x40,0x00,0x40,0x00,0x42,0x00,0x41,0x00,0x40,0x80,0x40,0x60,0x40,0x00,0x40,0x00,0x00,0x00},/*"下",44*/
    {0x00,0x40,0x02,0x40,0x04,0x40,0x18,0x40,0xF0,0x40,0x10,0x40,0x10,0x40,0x1F,0xFF,0x10,0x40,0x10,0x40,0x10,0x40,0x10,0x40,0x10,0x40,0x00,0x40,0x00,0x40,0x00,0x00},/*"午",45*/

};

/*
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x20,0x00,0x08,0x00,0x40,0x00,0x0C,0x00,0xC0,0x00,0x0C,0x01,0x80,0x00,0x08,0x07,0x00,0x00,0x08,0x1E,0x00,0x00,0x08,0x78,0x00},
{0x0C,0x1F,0xC0,0x00,0x0F,0xFC,0x00,0x00,0x06,0x10,0x00,0x00,0x00,0x30,0x00,0x00,0x00,0x7F,0xFF,0x00,0x00,0x38,0x01,0xC0,0x00,0x20,0x00,0xC0,0x00,0x00,0x00,0x60,0x00,0x00,0x00,0x60},
{0x00,0x7F,0xF0,0x20,0x00,0x7F,0xFC,0x20,0x00,0x46,0x20,0x30,0x00,0x44,0x20,0x30,0x00,0x44,0x20,0x30,0x00,0xC0,0x30,0x30,0x00,0xFF,0xFC,0x30,0x00,0x7F,0xF8,0x30,0x00,0x40,0x00,0x60},
{0x00,0x00,0x00,0x60,0x00,0x00,0x00,0xE0,0x00,0x00,0x07,0xE0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x60,0x00,0x20,0x00,0xE0,0x00,0x60,0x71,0xC0,0x00,0x60,0xE3,0x80},
{0x00,0x63,0xE6,0x00,0x00,0x66,0x60,0x00,0x00,0x7C,0x40,0x00,0x00,0x70,0x40,0x10,0x01,0xE0,0x40,0x18,0x3F,0xC0,0xC0,0x1C,0x3E,0x4E,0xC0,0x3C,0x18,0xCF,0xFF,0xF8,0x00,0xC4,0x80,0x00},
{0x00,0xC0,0x80,0x00,0x00,0xC0,0x80,0x00,0x00,0xC1,0x80,0x00,0x01,0x81,0x84,0x00,0x01,0x81,0x86,0x00,0x00,0x81,0x87,0x00,0x00,0x80,0x83,0x80,0x00,0x00,0x03,0xC0,0x00,0x00,0x01,0xC0},
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x01,0x00,0x00,0x03,0x02,0x00,0x00,0x03,0x04,0x00,0x00,0x02,0x08,0x00,0x00,0x46,0x10,0x00,0x00,0x46,0x60,0x00,0x00,0x84,0xC0,0x00},
{0x01,0x87,0x80,0x60,0x03,0xFF,0xFF,0xF8,0x02,0x68,0x80,0x00,0x0E,0x08,0xC0,0x00,0x0C,0x18,0x40,0x00,0x04,0x18,0x20,0x00,0x00,0x00,0x20,0x00,0x00,0x00,0x20,0x00,0x00,0x04,0x20,0x00},
{0x00,0xC6,0x20,0x00,0x00,0xC6,0x60,0x00,0x00,0x60,0x40,0x00,0x10,0x00,0x40,0x00,0x1F,0xFF,0xFF,0xE0,0x1F,0xFF,0xFF,0xFC,0x08,0x00,0xC0,0x00,0x00,0x00,0x80,0x00,0x00,0x00,0x80,0x00},
{0x00,0x00,0x80,0x00,0x00,0x01,0x80,0x00,0x00,0x01,0x80,0x00,0x00,0x00,0x80,0x00,0x00,0x00,0x00,0x00},
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x0E,0x00,0x00,0x08,0x0E,0x00,0x00,0x08,0x0C,0x00,0x00,0x08,0x18,0x00,0x00,0x08,0x30,0x20,0x00,0x18,0x20,0x30},
{0x1F,0xFF,0xFF,0xF8,0x1F,0xFF,0xFF,0xF0,0x08,0x10,0x80,0x00,0x00,0x11,0x00,0x00,0x00,0x00,0x00,0x10,0x00,0x00,0x40,0x20,0x00,0x10,0x50,0x20,0x00,0x10,0x50,0x60,0x00,0x30,0xC8,0x60},
{0x00,0x30,0x8C,0xC0,0x1C,0x3F,0x87,0x80,0x1F,0xFF,0x83,0x80,0x0E,0x61,0x8F,0x80,0x00,0x61,0xFC,0xC0,0x00,0x61,0xE0,0xE0,0x00,0x40,0x80,0x70,0x00,0x40,0x00,0x30,0x00,0x00,0x00,0x30},
{0x00,0x00,0x00,0x30,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x00},
*/

void OLED_UI_DrawPoint(uint8_t x,uint8_t y,uint8_t t)
{
    uint8_t pos,bx,temp=0;
    if(x>127||y>63)return;//超出范围了.
    pos=7-y/8;
    bx=y%8;
    temp=1<<(7-bx);
    if(t)OLED_GRAM[x][pos]|=temp;
    else OLED_GRAM[x][pos]&=~temp;
}

void ui_show_font(uint16_t x,uint16_t y,const uint8_t *font,uint8_t f_w,uint8_t f_h,uint8_t mode)
{
    const char* font_table;
    uint16_t fontSeq;
    uint8_t temp,t,t1;
    uint16_t y0=y;
    uint8_t csize=(f_h/8+((f_h%8)?1:0))*f_w;//得到自由分辨字符所占的字节数

    if(f_w==32 && f_h==32)
        font_table = font1212_table;
    else return;/*没有的字库*/
    for(fontSeq=0; fontSeq<strlen(font_table)/2; fontSeq++)/*计算font_table对应字库的数组下标*/
    {
        if(font_table[2*fontSeq]==font[0] && font_table[2*fontSeq+1]==font[1])
            break;
    }
    if(fontSeq >= strlen(font_table)/2) return;/*font_table中没有font该字*/

    for(t=0; t<csize; t++)
    {
        if(f_w==32 && f_h==32)
            temp = font_1212[fontSeq][t];/*调用font_1212字库*/
        for(t1=0; t1<8; t1++)
        {
            if(temp&0x80)OLED_UI_DrawPoint(x,y,mode);
            else OLED_UI_DrawPoint(x,y,!mode);
            temp<<=1;
            y++;
            if((y-y0)==f_h)
            {
                y=y0;
                x++;
                break;
            }
        }
    }
}

//显示一个指定大小的汉字
//x,y :汉字的坐标
//font:汉字GBK码
//f_w:字宽
//f_h:字高
//mode:0,正常显示,1,叠加显示
void show_font(uint16_t x,uint16_t y,const uint8_t *font,uint8_t f_w,uint8_t f_h,uint8_t mode)
{
    const char* font_table;
    uint16_t fontSeq;
    uint8_t temp,t,t1;
    uint16_t y0=y;
    uint8_t csize=(f_h/8+((f_h%8)?1:0))*f_w;//得到自由分辨字符所占的字节数

    if(f_w==12 && f_h==12)
        font_table = font1212_table;
    else if(f_w==16 && f_h==16)
        font_table = font1616_table;
    else return;/*没有的字库*/
    for(fontSeq=0; fontSeq<strlen(font_table)/2; fontSeq++)/*计算font_table对应字库的数组下标*/
    {
        if(font_table[2*fontSeq]==font[0] && font_table[2*fontSeq+1]==font[1])
            break;
    }
    if(fontSeq >= strlen(font_table)/2) return;/*font_table中没有font该字*/

    for(t=0; t<csize; t++)
    {
        if(f_w==12 && f_h==12)
            temp = font_1212[fontSeq][t];/*调用font_1212字库*/
        else if(f_w==16 && f_h==16)
            temp = font_1616[fontSeq][t];/*调用font_1616字库*/
        for(t1=0; t1<8; t1++)
        {
            if(temp&0x80)OLED_DrawPoint(x,y,mode);
            else OLED_DrawPoint(x,y,!mode);
            temp<<=1;
            y++;
            if((y-y0)==f_h)
            {
                y=y0;
                x++;
                break;
            }
        }
    }
}

//在指定位置开始显示一个字符串
//支持自动换行
//(x,y):起始坐标
//width,height:区域
//str  :字符串
//f_w:字宽
//f_h:字高
//mode:0,非叠加方式;1,叠加方式
void show_str(uint16_t x,uint16_t y,const uint8_t*str,uint8_t f_h,uint8_t mode)
{
    uint16_t x0=x;
    uint16_t y0=y;
    uint8_t bHz=0;     //字符或者中文
    while(*str!=0)//数据未结束
    {
        if(!bHz)
        {
            if(*str>0x80)bHz=1;//中文
            else               //字符
            {
                if(x>(x0+LCD_WIDTH-f_h/2))//换行
                {
                    y+=f_h;
                    x=x0;
                }
                if(y>(y0+LCD_HIGH-f_h))break;//越界返回
                if(*str==13)//换行符号
                {
                    y+=f_h;
                    x=x0;
                    str++;
                }
                else OLED_ShowChar(x,y,*str,f_h,mode);//有效部分写入
                str++;
                x+=f_h/2; //字符,为全字的一半
            }
        } else//中文
        {
            bHz=0;//有汉字库
            if(x>(x0+LCD_WIDTH-f_h))//换行
            {
                y+=f_h+2;//2为行间距
                x=x0;
            }
            if(y>(y0+LCD_HIGH-f_h))break;//越界返回
            show_font(x,y,str,f_h,f_h,mode); //显示这个汉字,空心显示
            str+=2;
            x+=f_h;//下一个汉字偏移
        }
    }
}
//在指定宽度的中间显示字符串
//如果字符长度超过了len,则用Show_Str显示
//len:指定要显示的宽度
void show_str_mid(uint16_t x,uint16_t y,const uint8_t*str,uint8_t f_h,uint8_t mode,uint16_t len)
{
    uint16_t strlenth=0;
    strlenth=strlen((char*)str);
    strlenth*=f_h/2;
    if(strlenth>len)show_str(x,y,str,f_h,mode);
    else
    {
        strlenth=(len-strlenth)/2;
        show_str(strlenth+x,y,str,f_h,mode);
    }
}

//10*16==宽*高  电量.bmp*13
const unsigned char bmp_battery[13][20]=
{
    {0x3F,0xFF,0x20,0x01,0x20,0x01,0xE0,0x01,0x80,0x01,0x80,0x01,0xE0,0x01,0x20,0x01,0x20,0x01,0x3F,0xFF},/*0格电量.BMP*/
    {0x3F,0xFF,0x20,0x03,0x20,0x03,0xE0,0x03,0x80,0x03,0x80,0x03,0xE0,0x03,0x20,0x03,0x20,0x03,0x3F,0xFF},/*1格电量.BMP*/
    {0x3F,0xFF,0x20,0x07,0x20,0x07,0xE0,0x07,0x80,0x07,0x80,0x07,0xE0,0x07,0x20,0x07,0x20,0x07,0x3F,0xFF},/*2格电量.BMP*/
    {0x3F,0xFF,0x20,0x0F,0x20,0x0F,0xE0,0x0F,0x80,0x0F,0x80,0x0F,0xE0,0x0F,0x20,0x0F,0x20,0x0F,0x3F,0xFF},/*3格电量.BMP*/
    {0x3F,0xFF,0x20,0x1F,0x20,0x1F,0xE0,0x1F,0x80,0x1F,0x80,0x1F,0xE0,0x1F,0x20,0x1F,0x20,0x1F,0x3F,0xFF},/*4格电量.BMP*/
    {0x3F,0xFF,0x20,0x3F,0x20,0x3F,0xE0,0x3F,0x80,0x3F,0x80,0x3F,0xE0,0x3F,0x20,0x3F,0x20,0x3F,0x3F,0xFF},/*5格电量.BMP*/
    {0x3F,0xFF,0x20,0x7F,0x20,0x7F,0xE0,0x7F,0x80,0x7F,0x80,0x7F,0xE0,0x7F,0x20,0x7F,0x20,0x7F,0x3F,0xFF},/*6格电量.BMP*/
    {0x3F,0xFF,0x20,0xFF,0x20,0xFF,0xE0,0xFF,0x80,0xFF,0x80,0xFF,0xE0,0xFF,0x20,0xFF,0x20,0xFF,0x3F,0xFF},/*7格电量.BMP*/
    {0x3F,0xFF,0x21,0xFF,0x21,0xFF,0xE1,0xFF,0x81,0xFF,0x81,0xFF,0xE1,0xFF,0x21,0xFF,0x21,0xFF,0x3F,0xFF},/*8格电量.BMP*/
    {0x3F,0xFF,0x23,0xFF,0x23,0xFF,0xE3,0xFF,0x83,0xFF,0x83,0xFF,0xE3,0xFF,0x23,0xFF,0x23,0xFF,0x3F,0xFF},/*9格电量.BMP*/
    {0x3F,0xFF,0x27,0xFF,0x27,0xFF,0xE7,0xFF,0x87,0xFF,0x87,0xFF,0xE7,0xFF,0x27,0xFF,0x27,0xFF,0x3F,0xFF},/*10格电量.BMP*/
    {0x3F,0xFF,0x2F,0xFF,0x2F,0xFF,0xEF,0xFF,0x8F,0xFF,0x8F,0xFF,0xEF,0xFF,0x2F,0xFF,0x2F,0xFF,0x3F,0xFF},/*11格电量.BMP*/
    {0x3F,0xFF,0x3F,0xFF,0x3F,0xFF,0xFF,0xFF,0x9F,0xFF,0x9F,0xFF,0xFF,0xFF,0x3F,0xFF,0x3F,0xFF,0x3F,0xFF},/*12格电量.BMP*/
};

//显示图片
//x,y:起点坐标
//p_w:图片宽（单位像素）
//p_h:图片高（单位像素）
//*p:图片起始地址
void oled_showPicture(uint8_t x,uint8_t y,const uint8_t *p,uint8_t p_w,uint8_t p_h)
{
    uint8_t temp,i,col,row;
    uint8_t y0=y;
    uint8_t width=p_w;
    if(x+p_w>128)width=128-p_w;//实际显示宽度
    uint8_t high=p_h;
    if(y+p_h>64)high=64-p_h;//实际显示高度
    uint8_t exp_col_bytes=(p_h/8+((p_h%8)?1:0));//显示一列的字节数
    uint8_t act_col_bytes=(high/8+((high%8)?1:0));//实际显示一列的字节数

    for(row=0; row<width; row++) //列++
    {
        for(col=0; col<act_col_bytes; col++) //显示一列
        {
            temp = p[col+row*exp_col_bytes];
            for(i=0; i<8; i++)
            {
                if(temp&0x80)OLED_DrawPoint(x,y,1);
                else OLED_DrawPoint(x,y,0);
                temp<<=1;
                y++;
                if((y-y0)==high)
                {
                    y=y0;
                    x++;
                    break;
                }
            }
        }
    }
}

//初始化SSD1306
void OLED_Init(void)
{
    HAL_GPIO_WritePin(OLED_BS1_GPIO_Port,OLED_BS1_Pin,GPIO_PIN_SET);
    HAL_GPIO_WritePin(OLED_BS2_GPIO_Port,OLED_BS2_Pin,GPIO_PIN_SET);

    HAL_GPIO_WritePin(OLED_CS_GPIO_Port,OLED_CS_Pin,GPIO_PIN_SET);
    HAL_GPIO_WritePin(OLED_RW_GPIO_Port,OLED_RW_Pin,GPIO_PIN_SET);

#if OLED_MODE==1

    HAL_GPIO_WritePin(OLED_D0_GPIO_Port,OLED_D0_Pin,GPIO_PIN_SET);
    HAL_GPIO_WritePin(OLED_D1_GPIO_Port,OLED_D1_Pin,GPIO_PIN_SET);
    HAL_GPIO_WritePin(OLED_D2_GPIO_Port,OLED_D2_Pin,GPIO_PIN_SET);
    HAL_GPIO_WritePin(OLED_D3_GPIO_Port,OLED_D3_Pin,GPIO_PIN_SET);
    HAL_GPIO_WritePin(OLED_D4_GPIO_Port,OLED_D4_Pin,GPIO_PIN_SET);
    HAL_GPIO_WritePin(OLED_D5_GPIO_Port,OLED_D5_Pin,GPIO_PIN_SET);
    HAL_GPIO_WritePin(OLED_D6_GPIO_Port,OLED_D6_Pin,GPIO_PIN_SET);
    HAL_GPIO_WritePin(OLED_D7_GPIO_Port,OLED_D7_Pin,GPIO_PIN_SET);

    HAL_GPIO_WritePin(OLED_RW_GPIO_Port,OLED_RW_Pin,GPIO_PIN_SET);
    HAL_GPIO_WritePin(OLED_RD_GPIO_Port,OLED_RD_Pin,GPIO_PIN_SET);
    HAL_GPIO_WritePin(OLED_RESET_GPIO_Port,OLED_RESET_Pin,GPIO_PIN_SET);

#else
    HAL_GPIO_WritePin(OLED_D0_GPIO_Port,OLED_D0_Pin,GPIO_PIN_SET);
    HAL_GPIO_WritePin(OLED_D1_GPIO_Port,OLED_D1_Pin,GPIO_PIN_SET);

    HAL_GPIO_WritePin(OLED_RESET_GPIO_Port,OLED_RESET_Pin,GPIO_PIN_SET);

#endif

    HAL_GPIO_WritePin(OLED_RESET_GPIO_Port,OLED_RESET_Pin,GPIO_PIN_RESET);
    HAL_Delay(100);
    HAL_GPIO_WritePin(OLED_RESET_GPIO_Port,OLED_RESET_Pin,GPIO_PIN_SET);

    OLED_WR_Byte(0xAE,OLED_CMD); //关闭显示
    OLED_WR_Byte(0xD5,OLED_CMD); //设置时钟分频因子,震荡频率
    OLED_WR_Byte(80,OLED_CMD);   //[3:0],分频因子;[7:4],震荡频率
    OLED_WR_Byte(0xA8,OLED_CMD); //设置驱动路数
    OLED_WR_Byte(0X3F,OLED_CMD); //默认0X3F(1/64)
    OLED_WR_Byte(0xD3,OLED_CMD); //设置显示偏移
    OLED_WR_Byte(0X00,OLED_CMD); //默认为0

    OLED_WR_Byte(0x40,OLED_CMD); //设置显示开始行 [5:0],行数.

    OLED_WR_Byte(0x8D,OLED_CMD); //电荷泵设置
    OLED_WR_Byte(0x14,OLED_CMD); //bit2，开启/关闭
    OLED_WR_Byte(0x20,OLED_CMD); //设置内存地址模式
    OLED_WR_Byte(0x02,OLED_CMD); //[1:0],00，列地址模式;01，行地址模式;10,页地址模式;默认10;
    OLED_WR_Byte(0xA1,OLED_CMD); //段重定义设置,bit0:0,0->0;1,0->127;
    OLED_WR_Byte(0xC0,OLED_CMD); //设置COM扫描方向;bit3:0,普通模式;1,重定义模式 COM[N-1]->COM0;N:驱动路数
    OLED_WR_Byte(0xDA,OLED_CMD); //设置COM硬件引脚配置
    OLED_WR_Byte(0x12,OLED_CMD); //[5:4]配置

    OLED_WR_Byte(0x81,OLED_CMD); //对比度设置
    OLED_WR_Byte(0xEF,OLED_CMD); //1~255;默认0X7F (亮度设置,越大越亮)
    OLED_WR_Byte(0xD9,OLED_CMD); //设置预充电周期
    OLED_WR_Byte(0xf1,OLED_CMD); //[3:0],PHASE 1;[7:4],PHASE 2;
    OLED_WR_Byte(0xDB,OLED_CMD); //设置VCOMH 电压倍率
    OLED_WR_Byte(0x30,OLED_CMD); //[6:4] 000,0.65*vcc;001,0.77*vcc;011,0.83*vcc;

    OLED_WR_Byte(0xA4,OLED_CMD); //全局显示开启;bit0:1,开启;0,关闭;(白屏/黑屏)
    OLED_WR_Byte(0xA6,OLED_CMD); //设置显示方式;bit0:1,反相显示;0,正常显示
    OLED_WR_Byte(0xAF,OLED_CMD); //开启显示
    OLED_Clear();
}
